language: java
jdk:
 - oraclejdk8

# safelist
branches:
  only:
  - test

services:
  - mysql

before_install:
  - export STAGING_URL=jdbc:mysql://127.0.0.1:3306
  - export STAGING_USER=root
  - export STAGING_PW=""
  - export LOCATIONS=data_engineering
  - export SCHEMAS=public

install:
  - wget https://repo1.maven.org/maven2/org/flywaydb/flyway-commandline/5.0.7/flyway-commandline-5.0.7.tar.gz && tar -xvzf flyway-commandline-5.0.7.tar.gz

script:
  - cd flyway-5.0.7 && ./flyway -url=$STAGING_URL -user=$STAGING_USER -password=$STAGING_PW -locations=filesystem:/$LOCATIONS -schemas=$SCHEMAS migrate
  - echo "my_test_script.sh"

after_failure:
  - cd flyway-5.0.7 && ./flyway -url=$STAGING_URL -user=$STAGING_USER -password=$STAGING_PW -locations=filesystem:/$LOCATIONS -schemas=$SCHEMAS repair
